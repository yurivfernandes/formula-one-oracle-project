<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-      // Verifica√ß√£o de vers√£o e limpeza autom√°tica
      const CURRENT_VERSION = '3.0-drivers-validation';
      const STORED_VERSION = localStorage.getItem('app-version');
      
      if (STORED_VERSION !== CURRENT_VERSION) {
        console.log(`üîÑ Atualizando de ${STORED_VERSION || 'vers√£o desconhecida'} para ${CURRENT_VERSION}`);
        
        // Limpar dados espec√≠ficos de predi√ß√µes que podem estar desatualizados
        const keysToRemove = [
          'nextRacePrediction',
          'lastPredictionRace', 
          'lastPredictionRaceName',
          'championshipPrediction',
          'constructorsPrediction'
        ];
        
        keysToRemove.forEach(key => {
          localStorage.removeItem(key);
          console.log(`üóëÔ∏è Removido: ${key}`);
        });
        
        // Atualizar vers√£o
        localStorage.setItem('app-version', CURRENT_VERSION);
        localStorage.setItem('last-update', Date.now().toString());
        
        console.log('‚úÖ Dados limpos e vers√£o atualizada');
      }

      // Fun√ß√£o para limpar cache manualmente
      window.clearAppCache = function() {
        console.log('üßπ Limpando cache manualmente...');
        
        // Limpar localStorage
        const keysToRemove = [
          'nextRacePrediction',
          'lastPredictionRace', 
          'lastPredictionRaceName',
          'championshipPrediction',
          'constructorsPrediction'
        ];
        
        keysToRemove.forEach(key => localStorage.removeItem(key));
        
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({ type: 'CLEAR_CACHE' });
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        } else {
          window.location.reload();
        }
      };

      // Fun√ß√£o para resetar popup de instala√ß√£o PWA
      window.resetInstallPrompt = function() {
        localStorage.removeItem('ios-install-dismissed');
        localStorage.removeItem('mobile-install-dismissed');
        localStorage.removeItem('desktop-install-dismissed');
        console.log('Popup de instala√ß√£o PWA resetado');
      };

      // Escutar mensagens do Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.addEventListener('message', (event) => {
          if (event.data && event.data.type === 'CLEAR_OLD_DATA') {
            console.log('üì® Service Worker solicitou limpeza de dados antigos');
            
            const keysToRemove = [
              'nextRacePrediction',
              'lastPredictionRace', 
              'lastPredictionRaceName',
              'championshipPrediction',
              'constructorsPrediction'
            ];
            
            keysToRemove.forEach(key => {
              localStorage.removeItem(key);
            });
            
            localStorage.setItem('app-version', event.data.version);
            console.log('‚úÖ Dados limpos via Service Worker');
          }
        });
      }, user-scalable=no" />
  <title>F1 Analytics - Previs√µes e An√°lises F1</title>
  <meta name="description"
    content="Previs√µes e an√°lises inteligentes da F√≥rmula 1 powered by AI. Acompanhe classifica√ß√µes, resultados e previs√µes dos campeonatos." />
  <meta name="author" content="F1 Analytics Team" />
  <meta name="keywords" content="F√≥rmula 1, F1, previs√µes, an√°lises, AI, classifica√ß√µes, corridas, campeonato" />

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#dc2626" />
  <meta name="background-color" content="#ffffff" />
  <meta name="display" content="standalone" />
  <meta name="orientation" content="portrait-primary" />

  <!-- Apple PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="F1 Oracle" />
  <meta name="apple-touch-fullscreen" content="yes" />

  <!-- Microsoft PWA Meta Tags -->
  <meta name="msapplication-TileColor" content="#dc2626" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="msapplication-config" content="/browserconfig.xml" />

  <!-- Manifest -->
  <link rel="manifest" href="/manifest.json" />

  <!-- Favicon - Atualizado com novo design -->
  <link rel="icon" type="image/png" href="/favicon-f1-analytics.png" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

  <!-- Apple Touch Icons - Novo design -->
  <link rel="apple-touch-icon" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon-f1-analytics.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon-f1-analytics.png" />

  <!-- Android Chrome Icons - Novo design -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-f1-analytics.png" />
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-f1-analytics.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-f1-analytics.png" />

  <!-- Apple Splash Screens -->
  <link rel="apple-touch-startup-image" href="/splashscreens/apple-splash-2048-2732.jpg"
    media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/splashscreens/apple-splash-1668-2388.jpg"
    media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/splashscreens/apple-splash-1536-2048.jpg"
    media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/splashscreens/apple-splash-1125-2436.jpg"
    media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/splashscreens/apple-splash-1242-2208.jpg"
    media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/splashscreens/apple-splash-750-1334.jpg"
    media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/splashscreens/apple-splash-640-1136.jpg"
    media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />

  <!-- Open Graph Meta Tags - Otimizado para redes sociais -->
  <meta property="og:title" content="F1 Analytics - Previs√µes e An√°lises Inteligentes da F√≥rmula 1" />
  <meta property="og:description"
    content="An√°lises avan√ßadas e previs√µes precisas da F√≥rmula 1 powered by AI. Acompanhe classifica√ß√µes, resultados e previs√µes dos campeonatos em tempo real." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://formula-one-oracle.vercel.app" />
  <meta property="og:image"
    content="https://raw.githubusercontent.com/yurivfernandes/formula-one-oracle-project/refs/heads/main/public/favicon%20F1%20Analytics.png" />
  <meta property="og:image:secure_url"
    content="https://raw.githubusercontent.com/yurivfernandes/formula-one-oracle-project/refs/heads/main/public/favicon%20F1%20Analytics.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="512" />
  <meta property="og:image:height" content="512" />
  <meta property="og:image:alt" content="F1 Analytics - Previs√µes e An√°lises Inteligentes da F√≥rmula 1" />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="F1 Analytics" />

  <!-- Twitter Meta Tags - Otimizado para Twitter/X -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@f1analytics" />
  <meta name="twitter:creator" content="@f1analytics" />
  <meta name="twitter:title" content="F1 Analytics - Previs√µes Inteligentes da F√≥rmula 1" />
  <meta name="twitter:description"
    content="An√°lises avan√ßadas e previs√µes precisas da F√≥rmula 1 powered by AI. Acompanhe classifica√ß√µes e resultados em tempo real." />
  <meta name="twitter:image"
    content="https://raw.githubusercontent.com/yurivfernandes/formula-one-oracle-project/refs/heads/main/public/favicon%20F1%20Analytics.png" />
  <meta name="twitter:image:alt" content="F1 Analytics - Previs√µes Inteligentes da F√≥rmula 1" />

  <!-- WhatsApp Meta Tags -->
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="512" />
  <meta property="og:image:height" content="512" />

  <!-- LinkedIn Meta Tags -->
  <meta property="og:type" content="article" />
  <meta property="article:author" content="F1 Analytics Team" />
  <meta property="article:section" content="Sports" />
  <meta property="article:tag" content="Formula 1, F1, An√°lises, Previs√µes, AI" />

  <!-- Telegram Meta Tags -->
  <meta name="telegram:channel" content="@f1analytics" />
  <meta name="telegram:card" content="summary_large_image" />

  <!-- Discord Meta Tags -->
  <meta name="theme-color" content="#dc2626" />
  <meta name="discord:card" content="summary_large_image" />

  <!-- Cache Busting Headers -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="app-version" content="3.0-drivers-validation" />
  <meta name="build-timestamp" content="__BUILD_TIMESTAMP__" />

  <!-- Security Headers -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:;" />
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>

  <!-- Service Worker Registration com controle de atualiza√ß√£o -->
  <script>
    if ('serviceWorker' in navigator) {
      let refreshing;

      // Fun√ß√£o para limpar cache manualmente
      window.clearAppCache = function () {
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({ type: 'CLEAR_CACHE' });
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        }
      };

      // Fun√ß√£o para for√ßar atualiza√ß√£o
      window.forceUpdate = function () {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistration().then((registration) => {
            if (registration) {
              registration.update();
            }
          });
        }
      };

      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);

            // Verificar se h√° atualiza√ß√µes a cada 30 segundos
            setInterval(() => {
              registration.update();
            }, 30000);

            // Verificar se h√° atualiza√ß√µes
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // Nova vers√£o dispon√≠vel - mostrar notifica√ß√£o personalizada
                    showUpdateAvailable(newWorker);
                  }
                });
              }
            });
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });

      // Atualizar quando o service worker tomar controle
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        window.location.reload();
      });

      // Fun√ß√£o para mostrar notifica√ß√£o de atualiza√ß√£o
      function showUpdateAvailable(newWorker) {
        // Criar elemento de notifica√ß√£o
        const notification = document.createElement('div');
        notification.id = 'update-notification';
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #dc2626;
          color: white;
          padding: 16px 20px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          z-index: 10000;
          font-family: system-ui, sans-serif;
          font-size: 14px;
          max-width: 300px;
          animation: slideIn 0.3s ease-out;
        `;

        notification.innerHTML = `
          <div style="margin-bottom: 12px;">
            <strong>üèéÔ∏è Nova vers√£o dispon√≠vel!</strong>
          </div>
          <div style="margin-bottom: 12px; opacity: 0.9;">
            Atualize para ter acesso aos recursos mais recentes.
          </div>
          <div style="display: flex; gap: 8px;">
            <button onclick="updateApp()" style="
              background: white;
              color: #dc2626;
              border: none;
              padding: 6px 12px;
              border-radius: 4px;
              cursor: pointer;
              font-weight: 600;
              font-size: 12px;
            ">ATUALIZAR</button>
            <button onclick="dismissUpdate()" style="
              background: transparent;
              color: white;
              border: 1px solid rgba(255,255,255,0.5);
              padding: 6px 12px;
              border-radius: 4px;
              cursor: pointer;
              font-size: 12px;
            ">DEPOIS</button>
          </div>
        `;

        // Adicionar CSS para anima√ß√£o
        if (!document.getElementById('update-notification-styles')) {
          const style = document.createElement('style');
          style.id = 'update-notification-styles';
          style.textContent = `
            @keyframes slideIn {
              from { transform: translateX(100%); opacity: 0; }
              to { transform: translateX(0); opacity: 1; }
            }
          `;
          document.head.appendChild(style);
        }

        document.body.appendChild(notification);

        // Fun√ß√£o global para atualizar
        window.updateApp = function () {
          newWorker.postMessage({ type: 'SKIP_WAITING' });
          notification.remove();
        };

        // Fun√ß√£o global para dispensar
        window.dismissUpdate = function () {
          notification.remove();
        };

        // Auto-remover ap√≥s 10 segundos
        setTimeout(() => {
          if (document.getElementById('update-notification')) {
            notification.remove();
          }
        }, 10000);
      }
    }

    // Install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
    });

    // Fun√ß√£o para instalar a PWA
    function installPWA() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('PWA instalada');
          }
          deferredPrompt = null;
        });
      }
    }

    // Detectar quando a app foi instalada
    window.addEventListener('appinstalled', () => {
      console.log('PWA foi instalada');
    });

    // Verificar se est√° rodando como PWA
    function isRunningStandalone() {
      return window.matchMedia('(display-mode: standalone)').matches ||
        window.navigator.standalone === true;
    }
  </script>
</body>

</html>